<template>
  <t-dialog
    v-model:visible="visibleModal.data"
    header="切换设备"
    mode="modal"
    draggable
    :footer="false"
    top="24px"
  >
    <template #body>
      <t-loading :loading="loading">
        <div class="flex justify-between mb-2 space-x-2">
          <t-button @click="addFormVisible.data = true">
            <t-icon name="add" />
            创建新设备
          </t-button>
          <t-button @click="handleRefresh" variant="outline">
            <t-icon name="refresh" />
            刷新
          </t-button>
        </div>
        <t-list :split="true" style="max-height: 65vh;">
          <t-list-item v-for="item in listData.data" :key="item.ID">
            <t-list-item-meta :title="item.Name" :description="item.ApiTag" image="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjYzNTYwMzI2NTQ3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI1NjEiIGRhdGEtc3BtLWFuY2hvci1pZD0iYTMxM3guNzc4MTA2OS4wLmkwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPjxwYXRoIGQ9Ik04ODEuMzIgODgxLjMySDE0Mi42ODJWMTQyLjY4SDg4MS4zMnY3MzguNjR6IG0tNzI0LjU5OC0xNC4wNEg4NjcuMjhWMTU2LjcySDE1Ni43MjJ2NzEwLjU2eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU2MiI+PC9wYXRoPjxwYXRoIGQ9Ik0xNzQuOTQ4IDE3NC45NzR2Njc0LjA1Nmg2NzQuMTA4VjE3NC45NzRIMTc0Ljk0OHogbTY0My4xMzQgNTY2Ljc4NGwtNzUuNjQyIDc2LjNIMjgxLjYxNmwtNzUuNjQyLTc2LjMtMC4wNS00NTkuNDYgNzUuNjkyLTc2LjM0OEg3NDIuNDRsNzUuNjQyIDc2LjM0OHY0NTkuNDZ6IiBmaWxsPSIjREZERkRFIiBwLWlkPSIyNTYzIj48L3BhdGg+PHBhdGggZD0iTTMyNi4xNDQgMTU2LjcyaC03OS43ODJWMGg3OS43ODJ2MTU2LjcyeiBtLTY1Ljc0Mi0xNC4wNGg1MS43MDJWMTQuMDRoLTUxLjcwMnYxMjguNjR6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTY0Ij48L3BhdGg+PHBhdGggZD0iTTI3OC42NDggMzIuMjg0aDE1LjIxdjkyLjE1MmgtMTUuMjF6IiBmaWxsPSIjRkZEMzUxIiBwLWlkPSIyNTY1Ij48L3BhdGg+PHBhdGggZD0iTTQ3NC41MTIgMTU2LjcyaC03OS43ODJWMGg3OS43ODJ2MTU2LjcyeiBtLTY1Ljc0Mi0xNC4wNGg1MS43MDJWMTQuMDRoLTUxLjcwMnYxMjguNjR6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTY2Ij48L3BhdGg+PHBhdGggZD0iTTQyNy4wMTYgMzIuMjg0aDE1LjIxMnY5Mi4xNTJoLTE1LjIxMnoiIGZpbGw9IiNGRkQzNTEiIHAtaWQ9IjI1NjciPjwvcGF0aD48cGF0aCBkPSJNNjIyLjg3OCAxNTYuNzJoLTc5Ljc3NlYwaDc5Ljc3NnYxNTYuNzJ6IG0tNjUuNzM4LTE0LjA0aDUxLjY5OFYxNC4wNEg1NTcuMTR2MTI4LjY0eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU2OCI+PC9wYXRoPjxwYXRoIGQ9Ik01NzUuMzg0IDMyLjI4NGgxNS4yMDh2OTIuMTUyaC0xNS4yMDh6IiBmaWxsPSIjRkZEMzUxIiBwLWlkPSIyNTY5Ij48L3BhdGg+PHBhdGggZD0iTTc3MS4yNDggMTU2LjcyaC03OS43ODJWMGg3OS43ODJ2MTU2LjcyeiBtLTY1Ljc0Mi0xNC4wNGg1MS43MDJWMTQuMDRoLTUxLjcwMnYxMjguNjR6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTcwIj48L3BhdGg+PHBhdGggZD0iTTcyMy43NSAzMi4yODRoMTUuMjE0djkyLjE1MmgtMTUuMjE0eiIgZmlsbD0iI0ZGRDM1MSIgcC1pZD0iMjU3MSI+PC9wYXRoPjxwYXRoIGQ9Ik0zMjYuMTQ0IDEwMjRoLTc5Ljc4MnYtMTU2LjcyaDc5Ljc4MlYxMDI0eiBtLTY1Ljc0Mi0xNC4wNGg1MS43MDJ2LTEyOC42NGgtNTEuNzAydjEyOC42NHoiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI1NzIiPjwvcGF0aD48cGF0aCBkPSJNMjc4LjY0OCA4OTkuNTYyaDE1LjIxdjkyLjE1MmgtMTUuMjF6IiBmaWxsPSIjRkZEMzUxIiBwLWlkPSIyNTczIj48L3BhdGg+PHBhdGggZD0iTTQ3NC41MTIgMTAyNGgtNzkuNzgydi0xNTYuNzJoNzkuNzgyVjEwMjR6IG0tNjUuNzQyLTE0LjA0aDUxLjcwMnYtMTI4LjY0aC01MS43MDJ2MTI4LjY0eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU3NCI+PC9wYXRoPjxwYXRoIGQ9Ik00MjcuMDE2IDg5OS41NjJoMTUuMjEydjkyLjE1MmgtMTUuMjEyeiIgZmlsbD0iI0ZGRDM1MSIgcC1pZD0iMjU3NSI+PC9wYXRoPjxwYXRoIGQ9Ik02MjIuODc4IDEwMjRoLTc5Ljc3NnYtMTU2LjcyaDc5Ljc3NlYxMDI0eiBtLTY1LjczOC0xNC4wNGg1MS42OTh2LTEyOC42NEg1NTcuMTR2MTI4LjY0eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU3NiI+PC9wYXRoPjxwYXRoIGQ9Ik01NzUuMzg0IDg5OS41NjJoMTUuMjA4djkyLjE1MmgtMTUuMjA4eiIgZmlsbD0iI0ZGRDM1MSIgcC1pZD0iMjU3NyI+PC9wYXRoPjxwYXRoIGQ9Ik03NzEuMjQ4IDEwMjRoLTc5Ljc4MnYtMTU2LjcyaDc5Ljc4MlYxMDI0eiBtLTY1Ljc0Mi0xNC4wNGg1MS43MDJ2LTEyOC42NGgtNTEuNzAydjEyOC42NHoiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI1NzgiPjwvcGF0aD48cGF0aCBkPSJNNzIzLjc1IDg5OS41NjJoMTUuMjE0djkyLjE1MmgtMTUuMjE0eiIgZmlsbD0iI0ZGRDM1MSIgcC1pZD0iMjU3OSI+PC9wYXRoPjxwYXRoIGQ9Ik0xMDI0IDMyOS4zMzZoLTE1Ni43MnYtNzkuNzc4SDEwMjR2NzkuNzc4eiBtLTE0Mi42OC0xNC4wMzhoMTI4LjY0di01MS43aC0xMjguNjR2NTEuN3oiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI1ODAiPjwvcGF0aD48cGF0aCBkPSJNODk5LjU2NCAyODEuODQyaDkyLjE1djE1LjIxaC05Mi4xNXoiIGZpbGw9IiNGRkQzNTEiIHAtaWQ9IjI1ODEiPjwvcGF0aD48cGF0aCBkPSJNMTAyNCA0NzcuNzA0aC0xNTYuNzJ2LTc5Ljc3OEgxMDI0djc5Ljc3OHogbS0xNDIuNjgtMTQuMDRoMTI4LjY0di01MS43aC0xMjguNjR2NTEuN3oiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI1ODIiPjwvcGF0aD48cGF0aCBkPSJNODk5LjU2NCA0MzAuMjA4aDkyLjE1djE1LjIxMmgtOTIuMTV6IiBmaWxsPSIjRkZEMzUxIiBwLWlkPSIyNTgzIj48L3BhdGg+PHBhdGggZD0iTTEwMjQgNjI2LjA3MmgtMTU2Ljcydi03OS43NzhIMTAyNHY3OS43Nzh6IG0tMTQyLjY4LTE0LjA0aDEyOC42NHYtNTEuN2gtMTI4LjY0djUxLjd6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTg0Ij48L3BhdGg+PHBhdGggZD0iTTg5OS41NjQgNTc4LjU3OGg5Mi4xNXYxNS4yMWgtOTIuMTV6IiBmaWxsPSIjRkZEMzUxIiBwLWlkPSIyNTg1Ij48L3BhdGg+PHBhdGggZD0iTTEwMjQgNzc0LjQ0MmgtMTU2LjcyVjY5NC42NkgxMDI0djc5Ljc4MnogbS0xNDIuNjgtMTQuMDRoMTI4LjY0VjcwOC43aC0xMjguNjR2NTEuNzAyeiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU4NiI+PC9wYXRoPjxwYXRoIGQ9Ik04OTkuNTY0IDcyNi45NDRoOTIuMTV2MTUuMjEyaC05Mi4xNXoiIGZpbGw9IiNGRkQzNTEiIHAtaWQ9IjI1ODciPjwvcGF0aD48cGF0aCBkPSJNMTU2LjcyMiAzMjkuMzM2SDB2LTc5Ljc3OGgxNTYuNzIydjc5Ljc3OHpNMTQuMDQgMzE1LjI5OGgxMjguNjQydi01MS43SDE0LjA0djUxLjd6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTg4Ij48L3BhdGg+PHBhdGggZD0iTTMyLjI4NCAyODEuODQyaDkyLjE1MnYxNS4yMUgzMi4yODR6IiBmaWxsPSIjRkZEMzUxIiBwLWlkPSIyNTg5Ij48L3BhdGg+PHBhdGggZD0iTTE1Ni43MjIgNDc3LjcwNEgwdi03OS43NzhoMTU2LjcyMnY3OS43Nzh6IG0tMTQyLjY4Mi0xNC4wNGgxMjguNjQydi01MS43SDE0LjA0djUxLjd6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTkwIj48L3BhdGg+PHBhdGggZD0iTTMyLjI4NCA0MzAuMjA4aDkyLjE1MnYxNS4yMTJIMzIuMjg0eiIgZmlsbD0iI0ZGRDM1MSIgcC1pZD0iMjU5MSI+PC9wYXRoPjxwYXRoIGQ9Ik0xNTYuNzIyIDYyNi4wNzJIMHYtNzkuNzc4aDE1Ni43MjJ2NzkuNzc4eiBtLTE0Mi42ODItMTQuMDRoMTI4LjY0MnYtNTEuN0gxNC4wNHY1MS43eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU5MiI+PC9wYXRoPjxwYXRoIGQ9Ik0zMi4yODQgNTc4LjU3Nmg5Mi4xNTJ2MTUuMjEySDMyLjI4NHoiIGZpbGw9IiNGRkQzNTEiIHAtaWQ9IjI1OTMiPjwvcGF0aD48cGF0aCBkPSJNMTU2LjcyMiA3NzQuNDM4SDB2LTc5Ljc3NmgxNTYuNzIydjc5Ljc3NnogbS0xNDIuNjgyLTE0LjA0aDEyOC42NDJWNzA4LjdIMTQuMDR2NTEuNjk4eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjU5NCI+PC9wYXRoPjxwYXRoIGQ9Ik0zMi4yODQgNzI2Ljk0NGg5Mi4xNTJ2MTUuMjEySDMyLjI4NHoiIGZpbGw9IiNGRkQzNTEiIHAtaWQ9IjI1OTUiPjwvcGF0aD48cGF0aCBkPSJNNTg2LjY1MiA2NTYuMzZoLTEzOS4wMzhsLTg4LjYzNiA4Ny45ODJoLTE1MC40MWwtMi41NzQtMi42MjItMC4wNDYtMzIuODUySDM0MC40bDg2LjYyNC04Ny43OTRoMTU4LjY5NGE1MC4xOSA1MC4xOSAwIDAgMC0yLjcxNCAxNi40MjZjLTAuMDAyIDYuNjkyIDEuMjYgMTMuMDU2IDMuNjQ4IDE4Ljg2eiIgZmlsbD0iI0Y1OEU3MCIgcC1pZD0iMjU5NiI+PC9wYXRoPjxwYXRoIGQ9Ik02MzMuODk2IDY5NS40MzhjLTMxLjk0IDAtNTcuOTI2LTI1Ljk4Ni01Ny45MjYtNTcuOTI2czI1Ljk4Ni01Ny45MyA1Ny45MjYtNTcuOTNjMzEuOTQ2IDAgNTcuOTMyIDI1Ljk4OCA1Ny45MzIgNTcuOTMgMCAzMS45NC0yNS45ODYgNTcuOTI2LTU3LjkzMiA1Ny45MjZ6IG0wLTEwMS44MTZjLTI0LjE5OCAwLTQzLjg4OCAxOS42OS00My44ODggNDMuODkgMCAyNC4xOTggMTkuNjg4IDQzLjg4OCA0My44ODggNDMuODg4IDI0LjIwNCAwIDQzLjg5Mi0xOS42ODggNDMuODkyLTQzLjg4OHMtMTkuNjg4LTQzLjg5LTQzLjg5Mi00My44OXoiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI1OTciPjwvcGF0aD48cGF0aCBkPSJNNjMzLjg5NiA2NjUuMTc0Yy0xNS4yNTYgMC0yNy42NjQtMTIuNDA4LTI3LjY2NC0yNy42NjQgMC0xNS4yNTYgMTIuNDA4LTI3LjY2NCAyNy42NjQtMjcuNjY0IDE1LjI1NiAwIDI3LjY2NCAxMi40MDggMjcuNjY0IDI3LjY2NCAwIDE1LjI1Ni0xMi40MDggMjcuNjY0LTI3LjY2NCAyNy42NjR6IG0wLTQxLjI4NmExMy42MzggMTMuNjM4IDAgMCAwLTEzLjYyNCAxMy42MjQgMTMuNjM4IDEzLjYzOCAwIDAgMCAxMy42MjQgMTMuNjI0IDEzLjYzOCAxMy42MzggMCAwIDAgMTMuNjI0LTEzLjYyNCAxMy42MzggMTMuNjM4IDAgMCAwLTEzLjYyNC0xMy42MjR6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNTk4Ij48L3BhdGg+PHBhdGggZD0iTTQzNy4zNiAzNjcuNjcyaDEzOS4wMzhsODguNjM2LTg3Ljk4MmgxNTAuNDFsMi41NzQgMi42MjIgMC4wNDYgMzIuODUyaC0xMzQuNDUybC04Ni42MjQgODcuNzk0aC0xNTguNjk0YTUwLjE4IDUwLjE4IDAgMCAwIDIuNzE0LTE2LjQyNmMwLjAwMi02LjY5Mi0xLjI2Mi0xMy4wNTYtMy42NDgtMTguODZ6IiBmaWxsPSIjRjU4RTcwIiBwLWlkPSIyNTk5Ij48L3BhdGg+PHBhdGggZD0iTTM2MS44NyA3NTEuMzU4aC0xNTYuMjQ0bC02LjY0OC02Ljc2LTAuMDYtNDIuNzU0aDEzOC41NDRsODYuNjIyLTg3Ljc5MmgxNzEuNDk0bC0zLjIzMiA5LjMxOGE0My4wNzYgNDMuMDc2IDAgMCAwLTIuMzI2IDE0LjEyNmMwIDUuNzA4IDEuMDUyIDExLjE1NiAzLjEyMiAxNi4xOTJsMy45OCA5LjY4OGgtMTQ2LjYybC04OC42MzIgODcuOTgyeiBtLTE0OC44NjQtMTQuMDRoMTQzLjA3OGw4OC42MzYtODcuOThoMTMyLjQ2NmE1Ny45NiA1Ny45NiAwIDAgMS0xLjIwMi0xMS44NDJjMC0zLjE4NiAwLjI1Mi02LjMzIDAuNzU0LTkuNDA2aC0xNDYuNzhsLTg2LjYyMiA4Ny43OTJoLTEzMC4zNmwwLjAzIDIxLjQzNnpNNTk5LjkyMiA0MDkuOTc4aC0xNzEuNDc0bDMuMjEyLTkuMzFhNDMuMjYgNDMuMjYgMCAwIDAgMi4zMjgtMTQuMTM2YzAtNS43MS0xLjA1Mi0xMS4xNTYtMy4xMjItMTYuMTg4bC0zLjk4OC05LjY5MmgxNDYuNjI2bDg4LjYzNC04Ny45ODJoMTU2LjI1NGw2LjY0IDYuNzY2IDAuMDYgNDIuNzQ2aC0xMzguNTQ4bC04Ni42MjIgODcuNzk2eiBtLTE1Mi42NDgtMTQuMDRoMTQ2Ljc4bDg2LjYyMi04Ny43OTJoMTMwLjM2bC0wLjAzMi0yMS40MzRoLTE0My4wNzhsLTg4LjYzNCA4Ny45ODJoLTEzMi40NjZjMC44IDMuODM2IDEuMjAyIDcuNzk0IDEuMjAyIDExLjgzOGE1OC40NCA1OC40NCAwIDAgMS0wLjc1NCA5LjQwNnoiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI2MDAiPjwvcGF0aD48cGF0aCBkPSJNMzkwLjExMiA0NDQuNDVjLTMxLjk0NCAwLTU3LjkyOC0yNS45ODYtNTcuOTI4LTU3LjkyOHMyNS45ODYtNTcuOTI4IDU3LjkyOC01Ny45MjggNTcuOTI4IDI1Ljk4NiA1Ny45MjggNTcuOTI4LTI1Ljk4NCA1Ny45MjgtNTcuOTI4IDU3LjkyOHogbTAtMTAxLjgxOGMtMjQuMjAyIDAtNDMuODkgMTkuNjg4LTQzLjg5IDQzLjg5czE5LjY4OCA0My44OSA0My44OSA0My44OSA0My44OS0xOS42ODggNDMuODktNDMuODktMTkuNjg4LTQzLjg5LTQzLjg5LTQzLjg5eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjYwMSI+PC9wYXRoPjxwYXRoIGQ9Ik0zOTAuMTEyIDQxNC4xODRjLTE1LjI1MiAwLTI3LjY2NC0xMi40MS0yNy42NjQtMjcuNjY0IDAtMTUuMjUyIDEyLjQxLTI3LjY2NCAyNy42NjQtMjcuNjY0IDE1LjI1NiAwIDI3LjY2NiAxMi40MSAyNy42NjYgMjcuNjY0IDAgMTUuMjU0LTEyLjQxIDI3LjY2NC0yNy42NjYgMjcuNjY0eiBtMC00MS4yODZjLTcuNTEyIDAtMTMuNjI0IDYuMTEyLTEzLjYyNCAxMy42MjRzNi4xMTIgMTMuNjI0IDEzLjYyNCAxMy42MjRjNy41MTQgMCAxMy42MjYtNi4xMTIgMTMuNjI2LTEzLjYyNHMtNi4xMTItMTMuNjI0LTEzLjYyNi0xMy42MjR6TTI3OS4yMjIgNTk5LjM5NmgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtMC0yOC4wNzhoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTAtMjguMDhoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTAtMjguMDc4aC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0wLTI4LjA4aC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0wLTI4LjA3OGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtMC0yOC4wOGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtMC0yOC4wNzhoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTAtMjguMDhoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTAuMDktMjcuNzUybC0xNC4wMjYtMC42NDhjMC4yMzQtNS4wNDYgMC44NzItMTAuMDk4IDEuOTAyLTE1LjAybDEzLjc0MiAyLjg3YTgwLjkzNCA4MC45MzQgMCAwIDAtMS42MTggMTIuNzk4eiBtNS4yNjYtMjUuMTdsLTEzLjEwMi01LjA0YTk0LjM2OCA5NC4zNjggMCAwIDEgNi41NjItMTMuNjZsMTIuMTI0IDcuMDc0YTgwLjcxIDgwLjcxIDAgMCAwLTUuNTg0IDExLjYyNnogbTEyLjk1OC0yMi4yMTZsLTEwLjg0NC04LjkxNmE5NS41MDQgOTUuNTA0IDAgMCAxIDEwLjUwNi0xMC44OTJsOS4zIDEwLjUyYTgxLjI0MiA4MS4yNDIgMCAwIDAtOC45NjIgOS4yODh6IG0xOS4yNzQtMTcuMDM4bC03LjUxNC0xMS44NmE5NC45MiA5NC45MiAwIDAgMSAxMy40MDItNy4wNTJsNS41MTYgMTIuOTFhODAuODQyIDgwLjg0MiAwIDAgMC0xMS40MDQgNi4wMDJ6IG0yMy42MjgtMTAuMDk4bC0zLjM3Mi0xMy42MjhhOTUuMjIyIDk1LjIyMiAwIDAgMSAxNC45NDItMi40NWwxLjE2IDEzLjk5YTgxLjQ4IDgxLjQ4IDAgMCAwLTEyLjczIDIuMDg4eiBtMjkyLjkyOC0yLjM2MmgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtLTI4LjA3OCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDggMGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtLTI4LjA3OCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDggMGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtLTI4LjA3OCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDggMGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtLTI4LjA4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbS0yOC4wNzggMGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtLTI4LjA4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHpNNjU5LjY5NCA3NjguOTU0aC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDc4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbS0yOC4wOCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDc4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbS0yOC4wOCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDc4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbS0yOC4wOCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDc4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbS0yOC4wOCAwaC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0tMjguMDc4IDBoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTI2Ny4zMTItMC4zMzRsLTEuMTM0LTEzLjk5NGE4MC4xMiA4MC4xMiAwIDAgMCAxMi43MS0yLjA4bDMuMzcyIDEzLjYyOGE5My43MDYgOTMuNzA2IDAgMCAxLTE0Ljk0OCAyLjQ0NnogbTI5LjMyMi03LjI1OGwtNS41My0xMi45MDZhODAuNTg0IDgwLjU4NCAwIDAgMCAxMS40MTItNi4wMDZsNy41MTQgMTEuODY0YTk1LjEwNCA5NS4xMDQgMCAwIDEtMTMuMzk2IDcuMDQ4eiBtMjUuNDkyLTE2LjEzNmwtOS4yOTYtMTAuNTJhODEuNjY2IDgxLjY2NiAwIDAgMCA4Ljk1OC05LjI4NmwxMC44NSA4LjkwMmE5NC45NTQgOTQuOTU0IDAgMCAxLTEwLjUxMiAxMC45MDR6IG0xOS4xNTQtMjMuMzE4bC0xMi4xMi03LjA5MmE3OS4yNiA3OS4yNiAwIDAgMCA1LjU4NC0xMS42MThsMTMuMTA4IDUuMDM2YTkzLjg0NiA5My44NDYgMCAwIDEtNi41NzIgMTMuNjc0eiBtMTAuODYtMjguMjE2bC0xMy43NDgtMi44N2MwLjg3OC00LjIgMS40MjItOC41MDYgMS42MjItMTIuNzk2bDE0LjAyMiAwLjY0OGE5NS41OSA5NS41OSAwIDAgMS0xLjg5NiAxNS4wMTh6IG0yLTI5LjM3NmgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtMC0yOC4wOGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0eiBtMC0yOC4wNzhoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTAtMjguMDhoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbS0xNC4wMzgtMjguMDc2bC0wLjAwNC0xNC4wNCAxNC4wNC0wLjAwNCAwLjAwNCAxNC4wNC0xNC4wNCAwLjAwNHogbTE0LjAzNC0yOC4wODJoLTE0LjA0di0xNC4wNGgxNC4wNHYxNC4wNHogbTAtMjguMDc4aC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0wLTI4LjA4aC0xNC4wNHYtMTQuMDRoMTQuMDR2MTQuMDR6IG0wLTI4LjA3OGgtMTQuMDR2LTE0LjA0aDE0LjA0djE0LjA0ek01MDMuNjc0IDU2OC44MzhoLTQ1LjYwNmMtMTUuMDU4IDAtMjcuMzA2LTEyLjI1LTI3LjMwNi0yNy4zMDZ2LTQwLjM5NGMwLTE1LjA1NiAxMi4yNDgtMjcuMzA2IDI3LjMwNi0yNy4zMDZoNDUuNjA2djE0LjA0aC00NS42MDZhMTMuMjg0IDEzLjI4NCAwIDAgMC0xMy4yNjggMTMuMjY4djQwLjM5NGExMy4yODQgMTMuMjg0IDAgMCAwIDEzLjI2OCAxMy4yNjhoNDUuNjA2djE0LjAzNnoiIGZpbGw9IiM0QjU1NUYiIHAtaWQ9IjI2MDIiPjwvcGF0aD48cGF0aCBkPSJNNDM3Ljc4MiA1MTQuMzE2aDY1Ljg5MnYxNC4wNGgtNjUuODkyek01NzguMzU2IDU2OC44MzhoLTQ3LjcyNnYtOTUuMDA2aDQ3LjcyNmMxNy43NiAwIDMyLjIxIDE0LjQ0OCAzMi4yMSAzMi4yMDh2MzAuNTkyYzAgMTcuNzU4LTE0LjQ1MiAzMi4yMDYtMzIuMjEgMzIuMjA2eiBtLTMzLjY4OC0xNC4wNGgzMy42ODZjMTAuMDE4IDAgMTguMTctOC4xNDggMTguMTctMTguMTY2VjUwNi4wNGMwLTEwLjAxOC04LjE1NC0xOC4xNjgtMTguMTctMTguMTY4aC0zMy42ODZ2NjYuOTI2eiIgZmlsbD0iIzRCNTU1RiIgcC1pZD0iMjYwMyI+PC9wYXRoPjxwYXRoIGQ9Ik03NDUuMzggODI1LjA3SDI3OC42NjJMMTk4Ljk2IDc0NC42MjZsLTAuMDYyLTQ2NS4yNDIgNzkuNzY4LTgwLjQ0SDc0NS4zOGw3OS43MDQgODAuNDQydjQ2NS4yNGwtNzkuNzA0IDgwLjQ0NHogbS00NjAuODYyLTE0LjA0aDQ1NS4wMTRsNzEuNTE0LTcyLjE4VjI4NS4xNjRsLTcxLjUxNC03Mi4xNzhIMjg0LjUxNGwtNzEuNTc4IDcyLjE4IDAuMDYyIDQ1My42ODQgNzEuNTIgNzIuMTh6IiBmaWxsPSIjNEI1NTVGIiBwLWlkPSIyNjA0Ij48L3BhdGg+PC9zdmc+" />
            <template #action>
              <t-tag v-if="item.ID===Number(route.params.id)" theme="primary" variant="light">当前设备</t-tag>
              <t-button v-else @click="handleChoose(item.ID)" variant="outline">选择</t-button>
            </template>
          </t-list-item>
        </t-list>
      </t-loading>
    </template>
  </t-dialog>

  <DeviceAddForm :show="addFormVisible" />
</template>

<script setup>
import {onBeforeUnmount, onMounted, reactive, ref, watch} from 'vue'
import api from "../../../../api/index.js";
import {useRoute, useRouter} from "vue-router";
import DeviceAddForm from "../../DeviceAddForm/DeviceAddForm.vue";
import PubSub from "pubsub-js";

const props = defineProps({
  show: Object,
  DeviceID: Object
})

const route = useRoute()
const router = useRouter()
const addFormVisible = reactive({data: false})

const loading = ref(false)
const visibleModal = reactive(props.show)
const listData = reactive({data: []})

watch(visibleModal, async (v) => {
  if (v.data === true) {
    await handleRefresh()
  }
})

function handleClose() {
  visibleModal.data = false
}

async function handleChoose(id) {
  visibleModal.data = false
  await router.push({
    path: `/device/${id}`
  })
}

async function handleRefresh() {
  if (!loading.value) {
    loading.value = true

    const data = await api.device.getDeviceInfo({ID: -1, Page:1, PageSize: 1000})
    if (data) {
      listData.data = data.data
    }

    loading.value = false
  }
}

onMounted(async () => {
  PubSub.subscribe("closeDeviceAddForm", handleRefresh)
})

onBeforeUnmount(() => {
  PubSub.unsubscribe("closeDeviceAddForm")
})
</script>

<style scoped>

</style>